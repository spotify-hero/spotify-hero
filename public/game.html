<!DOCTYPE html>
<html>
  <head>
    <title>TC Hero</title>
    
    <link rel="stylesheet" type="text/css" href="css/game.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Bangers" rel="stylesheet">
  </head>
  <body>
    <meta name="viewport" content="user-scalable=no">
    <script type="text/javascript" src="/build/game-bundle.js"></script>

    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
      var params = (() => {
        var hashParams = {};
        var e, r = /([^&;=]+)=?([^&;]*)/g,
            q = window.location.hash.substring(1);
        while ( e = r.exec(q)) {
           hashParams[e[1]] = decodeURIComponent(e[2]);
        }
        return hashParams;
      })();

      var access_token = params.access_token,
        refresh_token = params.refresh_token,
        error = params.error;

      console.log(params);

      window.onSpotifyWebPlaybackSDKReady = () => {
        const player = new Spotify.Player({
          name: 'Web Playback SDK Quick Start Player',
          getOAuthToken: cb => { cb(access_token); }
        });

        // Error handling
        player.addListener('initialization_error', ({ message }) => { console.error(message); });
        player.addListener('authentication_error', ({ message }) => { console.error(message); });
        player.addListener('account_error', ({ message }) => { console.error(message); });
        player.addListener('playback_error', ({ message }) => { console.error(message); });

        // Playback status updates
        // player.addListener('player_state_changed', state => { console.log(state); });

        // Ready
        player.addListener('ready', ({ device_id }) => {
          console.log('Ready with Device ID', device_id);
          document.getElementById('input_device_id').value = device_id;
        });

        // Not Ready
        player.addListener('not_ready', ({ device_id }) => {
          console.log('Device ID has gone offline', device_id);
        });

        // Connect to the player!
        player.connect();
      };
    </script>


    <div id="game-canvas">
      <div class="game-display">
        <div class="header">
          <p class="creator">Created by <span>Jay Schwartz</span></p>
          <h1 class="title">TC Hero</h1>
        </div>

        <div class="game-details">
          <div class="game-details-left">
            <h1 class="score">Score: 0</h1>
            <h1 class="max-streak">Max Streak: 0</h1>
          </div>

          <div class="player-spotify">
            <h1 class="title" style="padding:0;"> Spotify Player</h1>
            <div>
              <form action="javascript:void(0);" class="form-example">
                <input type ="text" id="input_device_id" style="display:none;" >
                <input type ="text" id="input_uri" value="spotify:track:4BgJZJW9b24DEt3ONiAIQP" required>
                <input type ="button" id="play_uri" value="&#9658;">
              </form>
            </div>
          </div>

          <div class="game-details-right">
            <h1 class="multiplier">Multiplier: 1X</h1>
            <h1 class="streak">Streak: 0</h1>
          </div>
        </div>

        <div class="game-start">
          <h1 class="start">PRESS "A" TO START</h1>
        </div>

        <div class="instructions hidden">
          <div class="close-instructions">
            <h1>X</h1>
            <h2>(close instructions)</h2>
          </div>
          <ul class="instructions-text">
            <h1>Instructions</h1>
            <li>As the colored notes move to the circles at the bottom of the fret board, hit the corresponding keys in sequence to score points!</li>
            <li>Score enough notes in a row, and your score multiplier will increase!</li>
            <li>To take a look around, click the button in the lower left hand corner.</li>
          </ul>
          <ul class="letters">
            <li class="green">S</li>
            <li class="red">D</li>
            <li class="yellow">K</li>
            <li class="blue">L</li>
          </ul>
        </div>

        <div class="pause hidden">
          <div class="retry-pause">
            <h1>RETRY</h1>
          </div>

          <div class="select-pause">
            <h1>SELECT SONG</h1>
          </div>

          <div class="record-pause">
            <h1>RECORD</h1>
          </div>
        </div>

        <div class="game-progress">
          <input
            class="rock-input"
            type="range"
            min="-20"
            max="20"
            value="0">
          </input>
          <h1 class="rock-header">Rock Meter</h1>
        </div>

      </div>
      <div class="game-control-panel">
        <button class="open-instructions">How To Play</button>
        <button class="look-around">Look Around</button>
        <button class="open-pause">Menu</button>
      </div>
    </div>
    <div id="song"></div>

    <div class="look-around-instructions hidden">
      <h1>CLICK AND DRAG TO LOOK AROUND</h1>
    </div>

  </body>
</html>
